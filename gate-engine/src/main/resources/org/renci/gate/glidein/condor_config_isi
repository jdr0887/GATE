######################################################################
##
##  condor_config
##
##  This is the global configuration file for condor.
##
######################################################################

LOG = $(WORK_DIR)/log
EXECUTE = $(WORK_DIR)/execute
COLLECTOR_HOST = $(HEAD_NODE)
FILESYSTEM_DOMAIN = $(HOSTNAME)
UID_DOMAIN = $(HOSTNAME)

SBIN = $(CONDOR_DIR)/sbin
LIB=$(CONDOR_DIR)/lib
LIBEXEC = $(CONDOR_DIR)/libexec

MAIL = /bin/mail
DAEMON_LIST = MASTER, STARTD
MASTER_ADDRESS_FILE = $(LOG)/.master_address
MASTER = $(SBIN)/condor_master
MASTER_LOG = $(LOG)/MasterLog
STARTD = $(SBIN)/condor_startd
STARTER = $(SBIN)/condor_starter

STARTER_LIST = STARTER

LOCK = $(LOG)
STARTD_LOG = $(LOG)/StartdLog
STARTER_LOG = $(LOG)/StarterLog

ALL_DEBUG = D_PID
STARTD_DEBUG = D_PID D_JOB
STARTER_DEBUG = D_PID 
MASTER_DEBUG = D_PID

# needed since Condor v6.9.2
# does not hurt for older versions
PROCD = $(SBIN)/condor_procd
PROCD_ADDRESS = $(LOCK)/procd_address
PROCD_LOG = $(LOG)/ProcLog
PROCD_DEBUG = False
PROCD_MAX_SNAPSHOT_INTERVAL = 60


SUSPEND = False
CONTINUE = True
PREEMPT = False
WANT_VACATE = False
WANT_SUSPEND = True
SUSPEND_VANILLA = False
WANT_SUSPEND_VANILLA = True

# if it ever enters the Preempting/Vacating state, get out of it in 5 minutes
# should never happen, but it is a good precaution
KILL = (CurrentTime-EnteredCurrentActivity>300)

IS_GLIDEIN = True
MASTER_ATTRS = IS_GLIDEIN, GLIDEIN_ToRetire, GLIDEIN_Expire, DaemonStopTime, $(GLIDEIN_VARIABLES)
STARTD_ATTRS = GLIDEIN_COLLECTOR_NAME,GLIDEIN_MASTER_NAME, IS_GLIDEIN, GLIDEIN_ToRetire, GLIDEIN_Expire, START, DaemonStopTime, GLIDEIN_PARENT_PID, $(GLIDEIN_VARIABLES)

# effectively disable checking of new binaries
MASTER_CHECK_NEW_EXEC_INTERVAL = 3600000

#If the daemon crashes, run away fast
MASTER_BACKOFF_CEILING = 600

# This section contains macros are here to help write legible
# expressions:

MINUTE          = 60
HOUR            = (60 * $(MINUTE))
StateTimer      = (CurrentTime - EnteredCurrentState)
ActivityTimer   = (CurrentTime - EnteredCurrentActivity)
ActivationTimer = (CurrentTime - JobStart)

BenchmarkTimer = (CurrentTime - LastBenchmark)
RunBenchmarks : (LastBenchmark == 0 ) || ($(BenchmarkTimer) >= (4 * $(HOUR)))

GSI_DAEMON_DIRECTORY=$(LOCAL_DIR)
SEC_DEFAULT_AUTHENTICATION = REQUIRED
SEC_DEFAULT_AUTHENTICATION_METHODS = GSI 

DENY_WRITE = anonymous@*
DENY_ADMINISTRATOR = anonymous@*
DENY_DAEMON = anonymous@*
DENY_NEGOTIATOR = anonymous@*

LOCAL_CONFIG_FILE       = 

GLIDEIN_START_CONDITION = ($(GLIDEIN_Start)) && ($(GLIDEIN_Entry_Start))

RANK = ($(GLIDEIN_Rank)) + ($(GLIDEIN_Entry_Rank))

# randomize update interval to minimize packet loss
UPDATE_INTERVAL = $RANDOM_INTEGER(270, 370, 1)
MASTER_UPDATE_INTERVAL = $RANDOM_INTEGER(270, 330, 1)

GLIDEIN_COLLECTOR_NAME = "$(HEAD_NODE)"
GLIDEIN_MASTER_NAME = "$(MASTER_NAME)@$(FULL_HOSTNAME)"
GLIDEIN_SCHEDD_NAME = "$(SCHEDD_NAME)@$(FULL_HOSTNAME)"

# ---- start of condor_startup generated part ----
USER_JOB_WRAPPER = $(LOCAL_DIR)/condor_job_wrapper.sh
GLIDEIN_Site="Viz"
GLIDEIN_Entry_Start=1
GLIDEIN_Entry_Rank=1
GLEXEC=NONE
GLIDEIN_Entry_Name="Viz"
GLIDEIN_Entry_Signature="ce225c8ef2b9ca9c1242ee1b68232ed3df78caf5"
GLIDEIN_Description_Entry_File="description.a3273I.cfg"
GLIDEIN_ClusterId=284
GLIDEIN_ProcId=0
GLIDEIN_Schedd="schedd_glideins1@gas.isi.edu"
GLIDEIN_Gatekeeper="viz-login.isi.edu/jobmanager-condor"
GLIDEIN_GridType="gt2"
GLIDEIN_Proxy_URL="None"
CONDOR_DIR=/var/condor/execute/dir_25728/glide_t25763/main/condor
GLIDEIN_Tmp_Dir="/var/condor/execute/dir_25728/glide_t25763/tmp"
GSI_DAEMON_PROXY=/var/condor/execute/dir_25728/glide_t25763/ticket/myproxy
X509_EXPIRE=1275923469
GSI_DAEMON_TRUSTED_CA_DIR=/etc/grid-security/certificates/
CERTIFICATE_MAPFILE=/var/condor/execute/dir_25728/glide_t25763/condor_mapfile
GLIDEIN_X509_GRIDMAP_DNS="/DC=org/DC=doegrids/OU=People/CN=Mats Rynge 274484,/DC=org/DC=doegrids/OU=Services/CN=gas.isi.edu,/DC=org/DC=doegrids/OU=Services/CN=yggdrasil.isi.edu,/DC=org/DC=doegrids/OU=People/CN=Mats Rynge 274484"
GSI_DAEMON_NAME=/DC=org/DC=doegrids/OU=People/CN=Mats Rynge 274484,/DC=org/DC=doegrids/OU=Services/CN=gas.isi.edu,/DC=org/DC=doegrids/OU=Services/CN=yggdrasil.isi.edu,/DC=org/DC=doegrids/OU=People/CN=Mats Rynge 274484
USE_CCB="True"
GLIDEIN_Start=1
GLIDEIN_Rank=1
JOB_INHERITS_STARTER_ENVIRONMENT=False
GLIDEIN_Max_Idle=1200
GLIDEIN_Retire_Time=21600
GLIDEIN_Retire_Time_Spread=7200
GLIDEIN_Job_Max_Time=360000
USE_PROCESS_GROUPS=False
UPDATE_COLLECTOR_WITH_TCP=False
WANT_UDP_COMMAND_SOCKET=False
STARTD_SENDS_ALIVES=True
SEC_DEFAULT_ENCRYPTION=OPTIONAL
SEC_DEFAULT_INTEGRITY=REQUIRED
SEC_ENABLE_MATCH_PASSWORD_AUTHENTICATION=True
MAX_MASTER_LOG=1000000
MAX_STARTD_LOG=10000000
MAX_STARTER_LOG=10000000
MASTER_GCB_RECONNECT_TIMEOUT=1200
GLIDECLIENT_Name="Viz@v1_0@mySites-gas@Corral_p6@yggdrasil.isi.edu"
GLIDECLIENT_Group="main"
GLIDECLIENT_Signature="00d65fda30e05f5fa8277650a9f27cf196e5ee32"
GLIDECLIENT_Group_Signature="a3581ff0fc8d8857f1fd3742c87c234efb777838"
HEAD_NODE=yggdrasil.isi.edu
GLIDEIN_Factory="mySites-gas"
GLIDEIN_Name="v1_0"
GLIDEIN_Signature="890edeaf321bfb0de917a71a77a5a207038823b9"
GLIDEIN_Description_File="description.a3273I.cfg"
GCB_ORDER="NONE"
CCB_ADDRESS=yggdrasil.isi.edu
GLEXEC_STARTER=False
GLEXEC_JOB=False
# ---- start of condor_startup fixed part ----

SEC_DEFAULT_SESSION_DURATION = 1035327

LOCAL_DIR = /var/condor/execute/dir_25728/glide_t25763

#GLIDEIN_EXPIRE = 
GLIDEIN_TORETIRE = 1274908673
GLIDEIN_START_TIME = 1274888441

STARTER_JOB_ENVIRONMENT = GLIDEIN_Site=Viz;GLIDEIN_Entry_Name=Viz;GLIDEIN_Entry_Signature=ce225c8ef2b9ca9c1242ee1b68232ed3df78caf5;GLIDEIN_ClusterId=284;GLIDEIN_ProcId=0;GLIDEIN_Schedd=schedd_glideins1@gas.isi.edu;GLIDEIN_Gatekeeper=viz-login.isi.edu/jobmanager-condor;GLIDEIN_GridType=gt2;GLIDEIN_Proxy_URL=None;GLIDEIN_Tmp_Dir=/var/condor/execute/dir_25728/glide_t25763/tmp;GLIDEIN_Expose_Grid_Env=False;GLIDECLIENT_Name=Viz@v1_0@mySites-gas@Corral_p6@yggdrasil.isi.edu;GLIDECLIENT_Group=main;GLIDECLIENT_Signature=00d65fda30e05f5fa8277650a9f27cf196e5ee32;GLIDECLIENT_Group_Signature=a3581ff0fc8d8857f1fd3742c87c234efb777838;GLIDEIN_Factory=mySites-gas;GLIDEIN_Name=v1_0;GLIDEIN_Signature=890edeaf321bfb0de917a71a77a5a207038823b9
GLIDEIN_VARIABLES = GLIDEIN_Site,GLIDEIN_Entry_Name,GLIDEIN_Entry_Signature,GLIDEIN_Description_Entry_File,GLIDEIN_ClusterId,GLIDEIN_ProcId,GLIDEIN_Schedd,GLIDEIN_Gatekeeper,GLIDEIN_GridType,GLIDEIN_Tmp_Dir,GLIDEIN_X509_GRIDMAP_DNS,USE_CCB,JOB_INHERITS_STARTER_ENVIRONMENT,GLIDEIN_Max_Idle,GLIDEIN_Job_Max_Time,MASTER_GCB_RECONNECT_TIMEOUT,GLIDECLIENT_Name,GLIDECLIENT_Group,GLIDECLIENT_Signature,GLIDECLIENT_Group_Signature,GLIDEIN_Factory,GLIDEIN_Name,GLIDEIN_Signature,GLIDEIN_Description_File,GCB_ORDER,GLEXEC_STARTER,GLEXEC_JOB

MASTER_NAME = glidein_27132
STARTD_NAME = glidein_27132

#This can be used for locating the proper PID for monitoring
GLIDEIN_PARENT_PID = 27132

# ---- start of include part ----
######################################################################
##
##  condor_config.dedicated_starter.include
##
##  Condor include file for main starter 
##
######################################################################

WORK_DIR=$(LOCAL_DIR)

# No need to be nice... I got the slot
JOB_RENICE_INCREMENT = 0

# force a single CPU (the WN could have many)
NUM_CPUS = 1
VIRTUAL_MACHINE_TYPE_1 = cpus=1, memory=100%, swap=100%, disk=100%
NUM_VIRTUAL_MACHINES_TYPE_1 = 1

HAS_MONITOR_VM=True
IS_MONITOR_VM = False
USES_MONITOR_STARTD = True

STARTD_ATTRS = $(STARTD_ATTRS), IS_MONITOR_VM, HAS_MONITOR_VM, USES_MONITOR_STARTD, Monitoring_Name

START = $(GLIDEIN_START_CONDITION)

IsOwner = False

# Max time a job is guaranteed to run in the glidein
# set it to several months... i.e. infinity
MaxJobRetirementTime=10000000
# How long does the job have after the startd enters retiring state
SHUTDOWN_GRACEFUL_TIMEOUT=$(GLIDEIN_Job_Max_Time)

# How long will it wait in an unclaimed state before exiting
STARTD_NOCLAIM_SHUTDOWN = $(GLIDEIN_Max_Idle)



Monitoring_Name = "monitor_27132@$(FULL_HOSTNAME)"
